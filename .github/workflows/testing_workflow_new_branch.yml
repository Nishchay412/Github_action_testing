name: Auto PR from feature branch to dev

on:
  create:
    branches:
      - "feature/*"   # adjust patterns to match your naming
      - "feat/*"

permissions:
  contents: read
  pull-requests: write

jobs:
  open-pr-to-dev:
    runs-on: ubuntu-latest

    steps:
      - name: Create PR from new feature branch to dev
        uses: actions/github-script@v7
        with:
          script: |
            const payload = context.payload;

            // Only act on branches (ignore tag creation)
            if (payload.ref_type !== 'branch') {
              core.info(`Ref type is ${payload.ref_type}, skipping.`);
              return;
            }

            const featureBranch = payload.ref;   // branch name, e.g. "feature/JIRA-123"
            const baseBranch = 'dev';

            core.info(`Creating PR from ${featureBranch} -> ${baseBranch}`);

            // Try to create the PR
            try {
              const { data: pr } = await github.rest.pulls.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `Auto PR: ${featureBranch} â†’ ${baseBranch}`,
                head: featureBranch,
                base: baseBranch,
                body: `This pull request was automatically created for branch \`${featureBranch}\` targeting \`${baseBranch}\`.`
              });

              core.info(`PR created: #${pr.number}`);
            } catch (error) {
              // If PR already exists or something similar, just log it
              core.warning(`Failed to create PR: ${error.message}`);
            }
